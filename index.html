<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frikilam</title>
    <link href="tienda.css" rel="stylesheet" />
    <link rel="preconnect" href="https://font.googleapis.com" />
    <link rel="preconnect" href="https://font.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Concensed&display=swap" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <header>
        <div class="header">
                <a href="">
                <img src="public/LOGO.png" alt="" class="logo" />
                </a>  
                 <!-- DESPLEGABLE -->  
                <nav class="desplegable">
                  <ul>
                    <li class="menu">
                      <a href="#">Filtrar</a>
                      <div class="dropdown">
                         
                        <!-- ANIME -->
                    <div class="sub-submenu">
                      <a href="#">Anime</a>
                      <div class="sub-sub-dropdown">
                        <a href="#" class="subcategory" data-path="Anime/Ataque_a_los_titanes">Ataque a los Titanes</a>
                        <a href="#" class="subcategory" data-path="Anime/Death_note">Death Note</a>
                        <a href="#" class="subcategory" data-path="Anime/Demon_Slayer">Demon Slayer</a>
                        <a href="#" class="subcategory" data-path="Anime/Dragon_Ball">Dragon Ball</a>
                        <a href="#" class="subcategory" data-path="Anime/Jujutsu_Kaise">Jujutsu Kaisen</a>
                        <a href="#" class="subcategory" data-path="Anime/Naruto">Naruto</a>
                        <a href="#" class="subcategory" data-path="Anime/One_Piece">One Piece</a>
                      </div>
                    </div>

                    <!-- DC -->
                    <div class="sub-submenu">
                      <a href="#">DC</a>
                      <div class="sub-sub-dropdown">
                        <a href="#" class="subcategory" data-path="DC/Arrow">Arrow</a>
                        <a href="#" class="subcategory" data-path="DC/Batman">Batman</a>
                        <a href="#" class="subcategory" data-path="DC/Wonder_woman">Wonder Woman</a>
                      </div>
                    </div>

                    <!-- MARVEL -->
                    <div class="sub-submenu">
                      <a href="#">Marvel</a>
                      <div class="sub-sub-dropdown">
                        <a href="#" class="subcategory" data-path="Marvel/Ant-man_&_the-wasp">Ant-Man & the Wasp</a>
                        <a href="#" class="subcategory" data-path="Marvel/Avengers">Avengers</a>
                        <a href="#" class="subcategory" data-path="Marvel/Black_panter">Black Panther</a>
                        <a href="#" class="subcategory" data-path="Marvel/Black_widow">Black Widow</a>
                        <a href="#" class="subcategory" data-path="Marvel/Capitan_America">Capit√°n Am√©rica</a>
                        <a href="#" class="subcategory" data-path="Marvel/Deadpool">Deadpool</a>
                        <a href="#" class="subcategory" data-path="Marvel/Doctor_strange">Doctor Strange</a>
                        <a href="#" class="subcategory" data-path="Marvel/Guardianes_de_la_Galaxia">Guardianes de la Galaxia</a>
                        <a href="#" class="subcategory" data-path="Marvel/Iron_man">Iron Man</a>
                        <a href="#" class="subcategory" data-path="Marvel/Spiderman">Spiderman</a>
                        <a href="#" class="subcategory" data-path="Marvel/Thor">Thor</a>
                      </div>
                    </div>
                      </div>
                    </li>
                  </ul>
                </nav>

                 <!-- BUSCADOR -->  
                <div class="search_cont">
                  <div class="search_box" style="position: relative;">
                      <input type="text" id="searchInput" placeholder="Buscar..." />
                      <span id="clearIcon" class="clear" style="display:none;">√ó</span>
                  </div>
                </div>

               <!-- USUARIO / FAVORITO / CARRITO -->
                <nav class="nav">
                  <ul class="menu">
                   
                    <li class="usuario">
                      <button class="icon-button" id="user-button">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="white" width="30" height="30" viewBox="0 0 24 24">
                          <path d="M12 12c2.7 0 4.8-2.1 4.8-4.8S14.7 2.4 12 2.4 7.2 4.5 7.2 7.2 9.3 12 12 12zm0 2.4c-3.2 0-9.6 1.6-9.6 4.8v2.4h19.2v-2.4c0-3.2-6.4-4.8-9.6-4.8z"/>
                        </svg>
                        <span id="user-name-display" style="color: white; margin-left: 8px; font-size: 14px;"></span>
                      </button>
                      <button id="logout-button" style="display: none; margin-left: 10px; background: none; border: none; color: white; cursor: pointer;">Cerrar sesi√≥n</button>
                    </li>
                    
                    <li class="favorito">
                      <button class="icon-button" id="favorites-button" title="Favoritos">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="white">
                          <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5
                                  C2 6.5 3.5 5 5.5 5
                                  C6.74 5 7.97 5.54 8.91 6.46
                                  L12 9.55l3.09-3.09
                                  C16.03 5.54 17.26 5 18.5 5
                                  C20.5 5 22 6.5 22 8.5
                                  C22 12.28 18.6 15.36 13.45 19.54L12 21.35z"/>
                        </svg>
                      </button>
                    </li>

                    <li class="carrito">
                      <button id="cart-icon" style="background: none; border: none; color: yellow; font-size: 18px;">
                        üõí <span id="cart-count">0</span>
                      </button>
                    </li>
                  </ul>
                </nav>


                <!-- MODAL USUARIO -->
                <div id="user-modal" class="hidden">
                  <div class="user-modal-content">
                    <span class="close-user-modal">&times;</span>
                    <div class="user-tabs">
                      <button id="login-tab" class="active-tab">Iniciar Sesi√≥n</button>
                      <button id="register-tab">Registrarse</button>
                    </div>

                    <form id="login-form" class="user-form">
                      <input type="email" id="login-email" placeholder="Correo electr√≥nico" required>
                      <input type="password" id="login-password" placeholder="Contrase√±a" required>
                      <button type="submit">Entrar</button>
                    </form>

                    <form id="register-form" class="user-form hidden">
                      <input type="text" id="register-name" placeholder="Nombre completo" required>
                      <input type="email" id="register-email" placeholder="Correo electr√≥nico" required>
                      <input type="password" id="register-password" placeholder="Contrase√±a" required>
                      <button type="submit">Registrarse</button>
                    </form>

                    <div id="user-message" style="color: red; margin-top: 10px;"></div>
                  </div>
                </div>
  
                <!-- MODAL FAVORITOS -->
                <div id="favorites-modal" class="hidden">
                  <div class="favorites-modal-content">
                    <button class="close-favorites" style="cursor:pointer;">&times;</button>
                    <h2>Favoritos</h2>
                    <div id="favorites-gallery"></div> <!-- Este es el contenedor para las im√°genes -->
                  </div>
                </div>


                <!-- MODAL CARRITO -->
               <div id="cart-modal" class="cart-modal cart-hidden">
                <div class="cart-modal-content">
                  <span class="close-cart">&times;</span>
                  <h2>Tu Carrito</h2>

                <div class="cart-body">
                  <div id="cart-items" class="cart-items"></div>
                  <div class="cart-summary-container">
                    <div id="cart-total" class="cart-total"></div> 
                    <div id="cart-summary" class="cart-summary">
                      <p id="subtotal"></p>
                      <p id="iva"></p>
                      <p id="envio"></p>
                      <p id="total-a-pagar" style="font-weight: bold;"></p>
                    </div>
                    <button id="pagar-btn">Pagar</button>
                  </div>
                </div>

                  <!-- Formulario de pago (oculto al inicio) -->
                  <form id="payment-form" class="hidden">
                    <span class="close-payment-form">&times;</span>
                    <h3>Datos de Env√≠o</h3>
                    <input type="text" name="nombre" placeholder="Nombre completo" required>
                    <input type="text" name="email" maxlength="24" placeholder="Email" required>
                    <input type="text" name="telefono" placeholder="Tel√©fono: +34 123456789" required>
                    <input type="text" name="direccion" placeholder="Direcci√≥n de env√≠o" required>
                    <input type="text" name="ciudad" placeholder="Ciudad" required>
                    <input type="text" name="provincia" placeholder="Provincia" required>
                    <input type="text" name="Codigo-postal" maxlength="5" placeholder="C√≥digo Postal" required>
                    <h3>Datos de la Tarjeta</h3>
                    <input type="text" name="tarjeta" maxlength="16" placeholder="N√∫mero de tarjeta" required>
                    <input type="text" id="exp" name="exp" maxlength="5" placeholder="MM/AA" required>
                      <small id="exp-error" style="color: red; display: none;">Fecha inv√°lida o expirada</small>
                    <input type="text" name="cvc" maxlength="4" placeholder="CVC" required>
                    <button type="submit">Confirmar pago</button>
                  </form>
                </div>



                
    </header>        
            
            
    <!-- IMAGENES WEB PRINCIPAL -->

      <div id="imageGallery"></div>
    
 
    <script>
      // Contiene las carpetas de im√°genes con su cantidad y precio correspondiente
        const folderImageCounts = {
          "Anime/Ataque_a_los_titanes": { count: 10, price: 15.99 },
          "Anime/Death_note": { count: 10, price: 12.99 },
          "Anime/Demon_Slayer": { count: 10, price: 13.99 },
          "Anime/Dragon_Ball": { count: 10, price: 14.99 },
          "Anime/Jujutsu_Kaise": { count: 10, price: 16.99 },
          "Anime/Naruto": { count: 10, price: 18.99 },
          "Anime/One_Piece": { count: 10, price: 19.99 },
          "DC/Arrow": { count: 6, price: 11.99 },
          "DC/Batman": { count: 6, price: 17.99 },
          "DC/Wonder_woman": { count: 4, price: 16.49 },
          "Marvel/Ant-man_&_the-wasp": { count: 6, price: 20.99 },
          "Marvel/Avengers": { count: 7, price: 21.99 },
          "Marvel/Black_panter": { count: 4, price: 18.99 },
          "Marvel/Black_widow": { count: 6, price: 15.49 },
          "Marvel/Capitan_America": { count: 4, price: 14.49 },
          "Marvel/Deadpool": { count: 4, price: 19.49 },
          "Marvel/Doctor_strange": { count: 4, price: 22.99 },
          "Marvel/Guardianes_de_la_Galaxia": { count: 6, price: 17.99 },
          "Marvel/Iron_man": { count: 5, price: 23.99 },
          "Marvel/Spiderman": { count: 5, price: 20.49 },
          "Marvel/Thor": { count: 4, price: 18.99 }
        };

        // Recupera carrito, favoritos y email actual del usuario desde localStorage, o inicializa vac√≠os
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        let currentUserEmail = localStorage.getItem('currentUserEmail') || '';

        // Espera a que el documento est√© completamente cargado
        document.addEventListener('DOMContentLoaded', () => {
          // Filtra favoritos inv√°lidos y los guarda nuevamente
          favorites = favorites.filter(f => typeof f === 'object' && f.folder && f.imageNumber);
          localStorage.setItem('favorites', JSON.stringify(favorites));

          
          actualizarUsuarioUI(currentUserEmail); // Actualiza la interfaz con el email del usuario 
          showImages(Object.keys(folderImageCounts)); // Muestra todas las im√°genes inicialmente
          
          // Actualiza el contador del carrito y muestra favoritos
          updateCartCount();
          updateFavoritesModal();

          // Abre modal de favoritos 
          document.getElementById('favorites-button')?.addEventListener('click', mostrarFavoritosModal);
          
          // Cierra el modal de favoritos
          document.querySelector('.close-favorites')?.addEventListener('click', () => {
            document.getElementById('favorites-modal').classList.add('hidden');
          });

          // Permite cambiar entre subcategor√≠as 
          document.querySelectorAll('.subcategory')?.forEach(button => {
            button.addEventListener('click', e => {
              e.preventDefault();
              showImages([button.dataset.path]);
            });
          });

          // Filtra im√°genes mientras el usuario escribe en la barra de b√∫squeda
          document.getElementById('searchInput')?.addEventListener('input', () => {
            const query = searchInput.value.trim().toLowerCase();
            const filtered = Object.keys(folderImageCounts).filter(folder => folder.toLowerCase().includes(query));
            showImages(filtered);
          });

          // Muestra el modal del carrito
          document.getElementById('cart-icon')?.addEventListener('click', () => {
            document.getElementById('cart-modal').classList.remove('cart-hidden');
            actualizarCarrito();
          });

          // Cierra el modal del carrito
          document.querySelector('.close-cart')?.addEventListener('click', () => {
            document.getElementById('cart-modal').classList.add('cart-hidden');
          });

          // Muestra el formulario de pago
          document.getElementById('pagar-btn')?.addEventListener('click', () => {
            document.getElementById('payment-form').classList.remove('hidden');
          });

          // Cierra el formulario de pago y el carrito
          document.querySelector('.close-payment-form')?.addEventListener('click', () => {
            document.getElementById('payment-form').classList.add('hidden');
            document.getElementById('cart-modal').classList.add('hidden');
          });


          // Configuraci√≥n del bot√≥n de usuario y logout
          const userBtn = document.getElementById('user-button');
          const userModal = document.getElementById('user-modal');
          const logoutBtn = document.getElementById('logout-button');
          let userMenuVisible = false;

          logoutBtn.style.display = 'none';

          userBtn?.addEventListener('click', (e) => {
            e.stopPropagation();
            userMenuVisible = !userMenuVisible;
            userModal.classList.toggle('hidden', !userMenuVisible);
            logoutBtn.style.display = userMenuVisible ? 'inline-block' : 'none';
          });

          // Cierra men√∫ de usuario si se hace clic fuera
          document.addEventListener('click', (e) => {
            if (userMenuVisible && !userModal.contains(e.target) && e.target !== userBtn) {
              userModal.classList.add('hidden');
              logoutBtn.style.display = 'none';
              userMenuVisible = false;
            }
          });

          // Cierra el modal del usuario
          document.querySelector('.close-user-modal')?.addEventListener('click', () => {
            userModal.classList.add('hidden');
            logoutBtn.style.display = 'none';
          });

          // Cierra sesi√≥n y limpia la UI
          logoutBtn?.addEventListener('click', () => {
            alert('Sesi√≥n cerrada');
            actualizarUsuarioUI('');
            userModal.classList.add('hidden');
          });

          // Cambia entre formulario de login y registro
          document.getElementById('login-tab')?.addEventListener('click', () => {
            document.getElementById('login-form').classList.remove('hidden');
            document.getElementById('register-form').classList.add('hidden');
          });

          document.getElementById('register-tab')?.addEventListener('click', () => {
            document.getElementById('register-form').classList.remove('hidden');
            document.getElementById('login-form').classList.add('hidden');
          });

          // Procesa el formulario de login
          document.getElementById('login-form')?.addEventListener('submit', e => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            alert(`Bienvenido ${email}`);
            actualizarUsuarioUI(email);
            userModal.classList.add('hidden');
          });

          // Procesa el formulario de registro
          document.getElementById('register-form')?.addEventListener('submit', e => {
            e.preventDefault();
            const email = document.getElementById('register-email').value;
            alert(`Cuenta creada para ${email}`);
            actualizarUsuarioUI(email);
            userModal.classList.add('hidden');
          });
        });

        // Actualiza y muestra el contenido del carrito
        function actualizarCarrito() {
        const cartItems = document.getElementById("cart-items");
        const subtotalElem = document.getElementById("cart-total");
        const ivaElem = document.getElementById("iva");
        const envioElem = document.getElementById("envio");
        const totalElem = document.getElementById("total-a-pagar");

        cartItems.innerHTML = ""; // Limpia carrito visual
        let subtotal = 0;

        // Genera din√°micamente cada √≠tem en el carrito
        cart.forEach((item, index) => {
          const itemElem = document.createElement("div");
          const img = document.createElement("img");
          img.src = `IMG/${item.folder}/${item.imageNumber}.jpg`;
          img.alt = `Imagen ${item.imageNumber}`;
          img.style.width = "50px";
          img.style.marginRight = "10px";

          const priceSpan = document.createElement("span");
          priceSpan.textContent = ` ‚Ç¨${item.price.toFixed(2)}`;

          const removeBtn = document.createElement("button");
          removeBtn.textContent = "Eliminar";
          removeBtn.style.marginLeft = "10px";
          removeBtn.onclick = () => {
            cart.splice(index, 1);
            localStorage.setItem('cart', JSON.stringify(cart));
            actualizarCarrito();
            updateCartCount();
          };

          itemElem.appendChild(img);
          itemElem.appendChild(priceSpan);
          itemElem.appendChild(removeBtn);
          cartItems.appendChild(itemElem);

          subtotal += item.price;
        });

        // Calcula el IVA incluido
        const iva = (21 / 121) * subtotal; // IVA incluido en el subtotal, se calcula la parte proporcional
        const envio = subtotal >= 20 ? 0 : 3; // Env√≠o gratis si >= 20‚Ç¨
        const total = subtotal + envio; // Total = subtotal (incluido IVA) + env√≠o

        console.log({ subtotal, iva, envio, total });

        // Muestra totales en la interfaz
        subtotalElem.innerText = `Subtotal (IVA incluido): ${subtotal.toFixed(2)} ‚Ç¨`;
        ivaElem.innerText = `IVA (21%) desglosado: ${iva.toFixed(2)} ‚Ç¨`;
        envioElem.innerText = envio === 0 ? "Env√≠o: Gratis" : `Gastos de env√≠o: ${envio.toFixed(2)} ‚Ç¨`;
        totalElem.innerText = `Total a pagar: ${total.toFixed(2)} ‚Ç¨`;
        }
        
        // Muestra el email del usuario logueado
        function actualizarUsuarioUI(email) {
          currentUserEmail = email;
          document.getElementById('user-name-display').textContent = email ? email.charAt(0).toUpperCase() : '';
          document.getElementById('logout-button').style.display = email ? 'inline-block' : 'none';
        }

        // Actualiza el n√∫mero mostrado del carrito
        function updateCartCount() {
          const cartCount = document.getElementById('cart-count');
          if (cartCount) cartCount.textContent = cart.length;
        }

        // A√±ade una imagen al carrito
        function addToCart(item) {
          cart.push(item);
          localStorage.setItem('cart', JSON.stringify(cart));
          updateCartCount();
          alert(`A√±adido al carrito:\n${item.folder} imagen ${item.imageNumber} - ‚Ç¨${item.price.toFixed(2)}`);
        }

        // A√±ade o elimina una imagen de favoritos
        function toggleFavorite(imageId, button) {
          const [folder, imageNumberStr] = imageId.split('-');
          const imageNumber = parseInt(imageNumberStr);
          const index = favorites.findIndex(f => f.folder === folder && f.imageNumber === imageNumber);

          if (index !== -1) {
            favorites.splice(index, 1);
            button.textContent = 'ü§ç';
          } else {
            favorites.push({ folder, imageNumber });
            button.textContent = '‚ù§Ô∏è';
          }

          localStorage.setItem('favorites', JSON.stringify(favorites));
          updateFavoritesModal();
        }

        // Manejar el env√≠o del formulario de pago
          document.getElementById('payment-form')?.addEventListener('submit', function(e) {
            e.preventDefault(); // Previene recarga de p√°gina

            // Obtener datos del formulario
            const nombre = e.target.nombre.value.trim();
            const email = e.target.email.value.trim();
            const telefono = e.target.telefono.value.trim();
            const direccion = e.target.direccion.value.trim();
            const ciudad = e.target.ciudad.value.trim();
            const provincia = e.target.provincia.value.trim();
            const cp = e.target["Codigo-postal"].value.trim();
            const tarjeta = e.target.tarjeta.value.trim();
            const exp = e.target.exp.value.trim();
            const cvc = e.target.cvc.value.trim();

            if (!nombre || !email || !telefono || !direccion || !ciudad || !provincia || !cp || !tarjeta || !exp || !cvc) {
              alert("Por favor, rellena todos los campos del formulario.");
              return;
            }

            alert('¬°Gracias por tu compra!');

            // Vaciar carrito
            cart = [];
            localStorage.setItem('cart', JSON.stringify(cart));

            // Actualizar interfaz
            updateCartCount();
            actualizarCarrito();

            // Cerrar formulario y modal
            document.getElementById('payment-form').classList.add('hidden');
            document.getElementById('cart-modal').classList.add('cart-hidden');
          });

            // casilla MM/AA
            document.addEventListener('DOMContentLoaded', () => {
            const expInput = document.getElementById('exp');
            const errorMsg = document.getElementById('exp-error');

            expInput.addEventListener('input', function (e) {
              let value = e.target.value.replace(/\D/g, ''); // Elimina no d√≠gitos

              // Agrega barra autom√°ticamente despu√©s de 2 d√≠gitos
              if (value.length >= 2) {
                value = value.slice(0, 2) + '/' + value.slice(2);
              }
              e.target.value = value.slice(0, 5); // M√°ximo 5 caracteres

              // Validaci√≥n de mes y a√±o
              if (e.target.value.length === 5) {
                const [mes, anio] = e.target.value.split('/').map(num => parseInt(num, 10));

                const hoy = new Date();
                const mesActual = hoy.getMonth() + 1; // getMonth es 0-indexado
                const anioActual = hoy.getFullYear() % 100; // Solo dos d√≠gitos

                const fechaValida = (
                  mes >= 1 && mes <= 12 &&
                  (anio > anioActual || (anio === anioActual && mes >= mesActual))
                );

                errorMsg.style.display = fechaValida ? 'none' : 'inline';
                expInput.setCustomValidity(fechaValida ? '' : 'Fecha de expiraci√≥n inv√°lida o pasada');
              } else {
                errorMsg.style.display = 'none';
                expInput.setCustomValidity('');
              }
            });
          });


        // Muestra im√°genes de las carpetas pasadas
        function showImages(folders) {
          const gallery = document.getElementById('imageGallery');
          gallery.innerHTML = '';
          folders.forEach(folder => {
            const data = folderImageCounts[folder];
            if (!data) return;
            for (let i = 1; i <= data.count; i++) {
              const container = document.createElement('div');
              container.classList.add('image-container');

              const img = document.createElement('img');
              img.src = `IMG/${folder}/${i}.jpg`;
              img.alt = `${folder} imagen ${i}`;
              img.classList.add('gallery-image');
              img.addEventListener('click', () => openModal(img.src));
              container.appendChild(img);

              const priceTag = document.createElement('p');
              priceTag.textContent = `‚Ç¨${data.price.toFixed(2)}`;
              priceTag.classList.add('price-tag');
              container.appendChild(priceTag);

              const actions = document.createElement('div');
              actions.classList.add('image-actions');

              const addToCartBtn = document.createElement('button');
              addToCartBtn.textContent = 'üõí A√±adir al carrito';
              addToCartBtn.classList.add('add-to-cart-btn');
              addToCartBtn.addEventListener('click', () => {
                addToCart({ folder, imageNumber: i, price: data.price });
              });

              const imageId = `${folder}-${i}`;
              const favoriteBtn = document.createElement('button');
              favoriteBtn.textContent = favorites.some(f => f.folder === folder && f.imageNumber === i) ? '‚ù§Ô∏è' : 'ü§ç';
              favoriteBtn.classList.add('favorite-btn');
              favoriteBtn.addEventListener('click', () => toggleFavorite(imageId, favoriteBtn));

              actions.appendChild(addToCartBtn);
              actions.appendChild(favoriteBtn);
              container.appendChild(actions);
              gallery.appendChild(container);
            }
          });
        }

        // Abre una imagen en un modal ampliado
        function openModal(imageSrc) {
          const modal = document.createElement('div');
          modal.classList.add('image-modal');
          modal.innerHTML = `<div class="modal-content"><span class="close-button">&times;</span><img src="${imageSrc}" alt="Imagen ampliada"></div>`;
          document.body.appendChild(modal);
          modal.querySelector('.close-button').addEventListener('click', () => modal.remove());
        }

        // Actualiza el modal de favoritos
        function updateFavoritesModal() {
          const modalGallery = document.getElementById('favorites-gallery');
          if (!modalGallery) return;
          modalGallery.innerHTML = '';
          if (favorites.length === 0) {
            modalGallery.innerHTML = '<p>No tienes im√°genes favoritas todav√≠a.</p>';
            return;
          }

          favorites.forEach(fav => {
            const data = folderImageCounts[fav.folder];
            if (!data) return;

            const container = document.createElement('div');
            container.classList.add('image-container');

            const img = document.createElement('img');
            img.src = `IMG/${fav.folder}/${fav.imageNumber}.jpg`;
            img.alt = `Favorito: ${fav.folder} ${fav.imageNumber}`;
            img.classList.add('gallery-image');
            img.addEventListener('click', () => openModal(img.src));
            container.appendChild(img);

            const priceTag = document.createElement('p');
            priceTag.textContent = `‚Ç¨${data.price.toFixed(2)}`;
            priceTag.classList.add('price-tag');
            container.appendChild(priceTag);

            const actions = document.createElement('div');
            actions.classList.add('image-actions');

            const addToCartBtn = document.createElement('button');
            addToCartBtn.textContent = 'üõí A√±adir al carrito';
            addToCartBtn.classList.add('add-to-cart-btn');
            addToCartBtn.addEventListener('click', () => {
              addToCart({ folder: fav.folder, imageNumber: fav.imageNumber, price: data.price });
            });

            const imageId = `${fav.folder}-${fav.imageNumber}`;
            const favoriteBtn = document.createElement('button');
            favoriteBtn.textContent = '‚ù§Ô∏è';
            favoriteBtn.classList.add('favorite-btn');
            favoriteBtn.addEventListener('click', () => {
              toggleFavorite(imageId, favoriteBtn);
              container.remove();
            });

            actions.appendChild(addToCartBtn);
            actions.appendChild(favoriteBtn);
            container.appendChild(actions);
            modalGallery.appendChild(container);
          });
        }

        // Muestra el modal de favoritos
        function mostrarFavoritosModal() {
          updateFavoritesModal();
          document.getElementById('favorites-modal').classList.remove('hidden');
        }
    </script>




      <div id="modal-overlay" class="modal-overlay hidden"></div>

   


</body>
</html>